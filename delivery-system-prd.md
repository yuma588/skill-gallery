# 外卖点单系统产品需求文档（PRD）

## 版本历史

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0 | 2026-01-29 | - | 初始版本 |

---

## 1. 项目概述

### 1.1 项目背景

随着互联网的快速发展和人们生活节奏的加快，外卖点单已成为现代生活的重要组成部分。用户希望通过便捷的移动端应用，随时随地浏览商品、下单购买，并实时跟踪订单状态。

本外卖点单系统旨在为用户提供一个简单易用、功能完整的在线点餐平台，满足用户从浏览商品到确认收货的全流程需求。

### 1.2 项目目标

本项目的主要目标是：

1. **用户体验目标**
   - 提供流畅的用户注册登录体验
   - 实现便捷的商品浏览和搜索功能
   - 确保购物车和下单流程简单直观
   - 提供清晰的订单状态跟踪和配送时间预估

2. **功能完整性目标**
   - 实现用户管理（注册、登录、个人信息管理、地址管理）
   - 实现商品管理（展示、搜索、分类、排序）
   - 实现购物车管理（添加、修改、删除、结算）
   - 实现订单管理（创建、查询、状态流转、取消、确认收货）
   - 实现支付功能（模拟在线支付流程）

3. **技术实现目标**
   - 采用Vue.js作为前端框架，确保良好的用户体验
   - 采用Node.js作为后端技术，保证系统的稳定性和扩展性
   - 使用MySQL作为数据库，确保数据的安全性和可靠性
   - 提供RESTful API接口，便于前后端分离开发

### 1.3 功能范围

**包含的功能**：
- 用户注册、登录、修改密码、个人信息管理
- 收货地址管理（新增、编辑、删除、设为默认）
- 商品列表、商品详情、商品搜索、分类筛选、排序
- 购物车管理（添加、修改数量、删除、结算）
- 订单管理（创建、查询、取消、确认收货）
- 订单状态流转（待支付、待发货、配送中、已完成、已取消）
- 模拟在线支付（支付宝、微信支付）
- 配送时间预估

**不包含的功能**：
- 商品推荐算法
- 订单评价系统
- 优惠券、满减活动等促销功能
- 会员积分系统
- 多商家入驻管理
- 实时消息通知
- 数据统计分析
- 多端适配（仅适配Web端）

---

## 2. 系统架构

### 2.1 技术选型

#### 前端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Vue.js | 3.x | 前端框架 |
| Vue Router | 4.x | 路由管理 |
| Pinia | 2.x | 状态管理 |
| Axios | 1.x | HTTP请求库 |
| Element Plus | - | UI组件库 |

#### 后端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | 18.x | 运行环境 |
| Express.js | 4.x | Web框架 |
| MySQL | 8.x | 数据库 |
| jsonwebtoken | - | Token生成和验证 |
| bcrypt | - | 密码加密 |
| mysql2 | - | MySQL驱动 |

#### 开发工具
| 工具 | 用途 |
|------|------|
| VS Code | 代码编辑器 |
| Postman | API测试工具 |
| Navicat | 数据库管理工具 |

### 2.2 整体架构

#### 2.2.1 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户端（Web）                        │
└──────────────────────────┬──────────────────────────────────┘
                           │ HTTP/HTTPS
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     后端服务（Node.js）                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │ 用户模块  │  │ 商品模块  │  │ 订单模块  │  │支付模块 │ │
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘ │
│  ┌──────────┐  ┌──────────┐                             │
│  │ 购物车模块│  │ 地址模块  │                             │
│  └──────────┘  └──────────┘                             │
│                                                             │
│  ┌──────────────────────────────────────────┐                │
│  │        RESTful API 接口层              │                │
│  └──────────────────────────────────────────┘                │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     MySQL 数据库                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ 用户表    │  │ 商品表    │  │ 订单表    │             │
│  └──────────┘  └──────────┘  └──────────┘             │
│  ┌──────────┐  ┌──────────┐                            │
│  │购物车表   │  │ 订单商品表  │                           │
│  └──────────┘  └──────────┘                            │
│  ┌──────────┐                                           │
│  │收货地址表  │                                           │
│  └──────────┘                                           │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2.2 系统分层架构

```
┌─────────────────────────────────────────┐
│       表现层（Vue.js 前端）            │
│  - 页面展示                           │
│  - 用户交互                           │
│  - 状态管理                           │
└──────────────┬────────────────────────┘
               │ RESTful API
               ▼
┌─────────────────────────────────────────┐
│     控制层（Express.js 路由）         │
│  - 接收请求                           │
│  - 参数校验                           │
│  - 返回响应                           │
└──────────────┬────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│     业务逻辑层（Service）              │
│  - 业务逻辑处理                       │
│  - 数据校验                           │
│  - 权限验证                           │
└──────────────┬────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│     数据访问层（DAO）                  │
│  - 数据库操作                         │
│  - SQL执行                           │
│  - 事务管理                           │
└──────────────┬────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│       数据层（MySQL）                  │
│  - 数据存储                           │
│  - 数据查询                           │
└─────────────────────────────────────────┘
```

#### 2.2.3 数据流转

**用户注册登录流程**：
1. 用户在前端输入手机号和密码
2. 前端调用 `/api/user/register` 或 `/api/user/login`
3. 后端接收请求，校验参数
4. 后端查询数据库，验证用户信息
5. 后端生成Token，返回给前端
6. 前端存储Token，用于后续请求的身份验证

**下单流程**：
1. 用户将商品加入购物车
2. 用户点击结算，调用 `/api/cart/list` 获取购物车
3. 用户确认订单信息，调用 `/api/orders/create` 创建订单
4. 后端生成订单号，订单状态设为"待支付"
5. 用户选择支付方式，调用 `/api/payment/pay` 发起支付
6. 后端模拟支付，订单状态变更为"待发货"
7. 商家发货，订单状态变更为"配送中"
8. 用户确认收货，订单状态变更为"已完成"

#### 2.2.4 部署架构

```
┌─────────────────────────────────────┐
│           Nginx 反向代理            │
└───────────┬─────────────────────────┘
            │
    ┌───────┴───────┐
    │               │
    ▼               ▼
┌───────┐       ┌──────────┐
│ 前端   │       │  后端     │
│ 静态资源│       │ (Node.js) │
└───────┘       └─────┬────┘
                    │
                    ▼
             ┌─────────────┐
             │   MySQL     │
             │   数据库     │
             └─────────────┘
```

**部署说明**：
- 前端打包为静态文件，由Nginx直接提供服务
- 后端Node.js服务运行在指定端口（如3000）
- Nginx作为反向代理，将API请求转发到后端服务
- MySQL数据库独立部署，存储所有业务数据

---

## 3. 功能需求

### 3.1 用户模块

#### 3.1.1 用户注册
- **功能描述**：用户通过手机号和密码完成注册
- **输入字段**：
  - 手机号（必填，11位数字，需校验格式）
  - 密码（必填，6-20位字符）
  - 确认密码（必填，需与密码一致）
- **校验规则**：
  - 手机号不能重复注册
  - 密码强度校验（建议包含字母和数字）
- **成功后行为**：自动登录，跳转至首页

#### 3.1.2 用户登录
- **功能描述**：用户通过手机号和密码登录系统
- **输入字段**：
  - 手机号（必填）
  - 密码（必填）
- **校验规则**：
  - 验证用户名和密码匹配
- **成功后行为**：保存登录状态，跳转至首页
- **失败处理**：提示"用户名或密码错误"

#### 3.1.3 修改密码
- **功能描述**：用户修改登录密码
- **输入字段**：
  - 旧密码（必填）
  - 新密码（必填，6-20位字符）
  - 确认新密码（必填，需与新密码一致）
- **校验规则**：
  - 验证旧密码正确性
- **成功后行为**：提示"密码修改成功"，保持登录状态

#### 3.1.4 退出登录
- **功能描述**：用户安全退出系统
- **操作流程**：点击"退出登录"按钮，确认后清除登录状态
- **成功后行为**：跳转至登录页

#### 3.1.5 查看个人信息
- **功能描述**：查看个人基本信息
- **显示内容**：
  - 昵称
  - 手机号
  - 注册时间

#### 3.1.6 修改个人信息
- **功能描述**：用户修改个人基本信息
- **可修改字段**：
  - 昵称（必填，2-20字符）
- **成功后行为**：提示"修改成功"

#### 3.1.7 收货地址管理
- **功能描述**：用户管理多个收货地址
- **功能点**：
  - 新增收货地址
    - 输入：收货人姓名、手机号、详细地址、是否设为默认地址
    - 校验：手机号格式、必填字段
  - 编辑收货地址
    - 可修改所有字段
  - 删除收货地址
    - 确认删除后移除
  - 设为默认地址
    - 每次下单自动选择默认地址

---

### 3.2 商品模块

#### 3.2.1 商品列表
- **功能描述**：展示所有商品列表
- **展示内容**：
  - 商品图片
  - 商品名称
  - 商品价格
  - 商品简短描述（可选）
- **分页显示**：每页20个商品
- **点击商品**：跳转至商品详情页

#### 3.2.2 商品详情
- **功能描述**：展示商品详细信息
- **展示内容**：
  - 商品轮播图
  - 商品名称
  - 商品价格
  - 商品详细描述
  - 商品规格（如有）
- **操作按钮**："加入购物车"、"立即购买"

#### 3.2.3 商品搜索
- **功能描述**：根据商品名称搜索商品
- **输入**：搜索关键词
- **搜索方式**：模糊匹配商品名称
- **展示结果**：商品列表形式展示匹配结果

#### 3.2.4 商品分类筛选
- **功能描述**：按商品分类筛选
- **分类方式**：预设商品分类（如：美食、饮品、甜点等）
- **展示结果**：选择分类后显示对应商品列表

#### 3.2.5 商品排序
- **功能描述**：对商品列表进行排序
- **排序选项**：
  - 价格从低到高
  - 价格从高到低
  - 销量从高到低
- **默认排序**：按添加时间倒序

#### 3.2.6 商品加入购物车
- **功能描述**：将商品添加到购物车
- **操作位置**：商品详情页、商品列表
- **输入**：商品数量（默认为1）
- **成功提示**："已加入购物车"

---

### 3.3 购物车模块

#### 3.3.1 购物车列表
- **功能描述**：展示购物车中所有商品
- **展示内容**：
  - 商品图片
  - 商品名称
  - 商品单价
  - 商品数量
  - 商品小计（单价 × 数量）
- **底部显示**：
  - 商品总数量
  - 商品总金额
- **操作按钮**："结算"

#### 3.3.2 修改商品数量
- **功能描述**：修改购物车中商品的数量
- **操作方式**：
  - 点击"+"按钮：数量+1
  - 点击"-"按钮：数量-1（最小为1）
  - 直接输入数量：输入1-999
- **实时更新**：商品小计和总金额实时计算

#### 3.3.3 删除购物车商品
- **功能描述**：从购物车中移除商品
- **操作方式**：点击商品旁的删除按钮
- **确认操作**：弹出确认对话框
- **成功后行为**：商品从购物车移除，总金额更新

#### 3.3.4 购物车结算
- **功能描述**：从购物车进入订单确认页
- **前置条件**：购物车中有商品
- **操作流程**：点击"结算"按钮，跳转至订单确认页

---

### 3.4 订单模块

#### 3.4.1 创建订单
- **功能描述**：用户创建新订单
- **操作入口**：购物车结算、商品立即购买
- **订单确认页内容**：
  - 商品列表（名称、价格、数量、小计）
  - 收货地址选择
  - 商品总金额
  - 配送费（可选，默认0）
  - 订单总金额
- **操作按钮**："提交订单"、"取消"
- **提交订单后**：
  - 生成订单号
  - 订单状态设为"待支付"
  - 跳转至支付页

#### 3.4.2 订单列表
- **功能描述**：展示用户的所有订单
- **Tab切换**：
  - 全部订单
  - 待支付
  - 待发货
  - 配送中
  - 已完成
- **展示内容**：
  - 订单号
  - 商品缩略图
  - 商品名称
  - 订单总金额
  - 订单状态
  - 下单时间
- **点击订单**：跳转至订单详情页

#### 3.4.3 订单详情
- **功能描述**：展示订单的详细信息
- **展示内容**：
  - 订单号
  - 订单状态
  - 下单时间
  - 商品列表（图片、名称、价格、数量、小计）
  - 收货地址
  - 商品总金额
  - 配送费
  - 订单总金额
  - 配送时间
  - 支付方式
  - 支付状态
- **操作按钮**：
  - 待支付状态："取消订单"、"去支付"
  - 配送中状态："确认收货"
  - 其他状态：无操作按钮

#### 3.4.4 取消订单
- **功能描述**：用户取消未支付的订单
- **前置条件**：订单状态为"待支付"
- **操作流程**：点击"取消订单"按钮，确认后取消
- **成功后行为**：订单状态变更为"已取消"

#### 3.4.5 确认收货
- **功能描述**：用户确认收到商品
- **前置条件**：订单状态为"配送中"
- **操作流程**：点击"确认收货"按钮，确认后完成
- **成功后行为**：订单状态变更为"已完成"

#### 3.4.6 订单状态流转
- **功能描述**：订单在不同状态间流转
- **状态定义**：
  - 待支付：订单已创建，等待用户支付
  - 待发货：用户已支付，等待商家发货
  - 配送中：商品配送中，等待用户收货
  - 已完成：用户已确认收货，订单完成
  - 已取消：用户或系统取消订单
- **状态流转规则**：
  - 待支付 → 待发货（用户支付成功）
  - 待支付 → 已取消（用户取消）
  - 待发货 → 配送中（商家发货）
  - 配送中 → 已完成（用户确认收货）

#### 3.4.7 查看配送时间
- **功能描述**：用户查看订单的预计送达时间
- **展示位置**：订单列表、订单详情
- **展示内容**：预计送达时间（如："预计今天18:00前送达"）

---

### 3.5 支付模块

#### 3.5.1 模拟支付
- **功能描述**：模拟在线支付流程
- **支付方式选择**：
  - 支付宝支付
  - 微信支付
- **支付流程**：
  1. 用户选择支付方式
  2. 点击"确认支付"
  3. 系统模拟支付处理（延迟1-2秒）
  4. 支付成功，跳转至支付结果页
- **支付成功结果**：
  - 显示"支付成功"
  - 显示订单号
  - 显示支付金额
  - 显示"查看订单"按钮
- **支付失败处理**：
  - 显示"支付失败"
  - 显示"重新支付"按钮

#### 3.5.2 支付状态查询
- **功能描述**：查询订单的支付状态
- **查询入口**：订单详情
- **展示内容**：
  - 支付状态（已支付/未支付）
  - 支付方式
  - 支付时间（如已支付）

---

## 4. 核心流程

### 4.1 用户注册登录流程

#### 4.1.1 注册流程
```
1. 用户打开注册页面
2. 输入手机号、密码、确认密码
3. 系统校验：
   - 手机号格式（11位数字）
   - 密码长度（6-20位）
   - 确认密码与密码一致
   - 手机号是否已注册
4. 校验通过 → 创建用户账号 → 自动登录 → 跳转至首页
5. 校验失败 → 显示错误提示
```

#### 4.1.2 登录流程
```
1. 用户打开登录页面
2. 输入手机号、密码
3. 系统校验用户名和密码
4. 校验成功 → 保存登录状态 → 跳转至首页
5. 校验失败 → 显示"用户名或密码错误"
```

#### 4.1.3 退出登录流程
```
1. 用户点击"退出登录"
2. 系统弹出确认对话框
3. 用户确认 → 清除登录状态 → 跳转至登录页
```

---

### 4.2 浏览商品下单流程

#### 4.2.1 浏览商品流程
```
1. 用户进入首页（商品列表）
2. 用户可以：
   - 浏览商品列表
   - 点击商品查看详情
   - 使用搜索框搜索商品
   - 使用分类筛选商品
   - 使用排序功能排序商品
3. 用户选择感兴趣的商品
```

#### 4.2.2 添加到购物车流程
```
1. 用户在商品详情页或商品列表
2. 选择商品数量（默认为1）
3. 点击"加入购物车"
4. 系统将商品添加到购物车
5. 显示提示"已加入购物车"
```

#### 4.2.3 下单流程
```
1. 用户打开购物车
2. 系统展示购物车商品列表
3. 用户可以修改商品数量、删除商品
4. 用户点击"结算"
5. 跳转至订单确认页
6. 用户确认：
   - 商品列表
   - 收货地址（选择或新增）
   - 订单金额
7. 用户点击"提交订单"
8. 系统生成订单，订单状态为"待支付"
9. 跳转至支付页
10. 用户选择支付方式
11. 用户点击"确认支付"
12. 系统模拟支付处理
13. 支付成功 → 订单状态变更为"待发货" → 跳转至支付成功页
14. 支付失败 → 显示"支付失败"，用户可重新支付
```

---

### 4.3 订单状态流转

#### 4.3.1 订单状态定义
| 状态 | 说明 | 允许的操作 |
|------|------|-----------|
| 待支付 | 订单已创建，等待用户支付 | 取消订单、去支付 |
| 待发货 | 用户已支付，等待商家发货 | 无操作 |
| 配送中 | 商品配送中，等待用户收货 | 确认收货 |
| 已完成 | 用户已确认收货，订单完成 | 查看详情 |
| 已取消 | 订单被取消 | 查看详情 |

#### 4.3.2 订单状态流转图
```
                    ┌──────────────┐
                    │   创建订单   │
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
                    │   待支付     │◄─────────┐
                    └──┬───┬───┬───┘          │
                       │   │   │              │
            ┌──────────┘   │   └───────┐      │
            │              │           │      │
     用户支付         用户取消     系统取消 │
            │              │           │      │
            ▼              │           │      │
    ┌───────▼──────┐      │           │      │
    │   待发货     │      │           │      │
    └──────┬───────┘      │           │      │
           │              │           │      │
      商家发货           │           │      │
           │              │           │      │
           ▼              │           │      │
    ┌──────▼──────┐      │           │      │
    │   配送中     │      │           │      │
    └──────┬───────┘      │           │      │
           │              │           │      │
    用户确认收货          │           │      │
           │              │           │      │
           ▼              │           │      │
    ┌──────▼──────┐      │           │      │
    │   已完成     │      │           │      │
    └─────────────┘      │           │      │
                         │           │      │
                         ▼           ▼      ▼
                    ┌──────────────────────┐
                    │      已取消          │
                    └──────────────────────┘
```

#### 4.3.3 状态流转规则
1. **待支付 → 待发货**：用户支付成功后自动流转
2. **待支付 → 已取消**：
   - 用户主动取消订单（待支付状态下）
   - 系统自动取消（如：订单超过30分钟未支付）
3. **待发货 → 配送中**：商家发货后，后台系统更新订单状态
4. **配送中 → 已完成**：用户确认收货后，订单状态变更为已完成

#### 4.3.4 配送时间计算
- **配送时间规则**：
  - 下单时间 00:00-12:00 → 预计当天18:00前送达
  - 下单时间 12:00-18:00 → 预计第二天12:00前送达
  - 下单时间 18:00-24:00 → 预计第二天18:00前送达

- **配送时间展示**：
  - 订单列表：显示"预计X月X日X点前送达"
  - 订单详情：显示详细配送时间信息

---

## 5. 数据模型设计

### 5.1 用户表（users）

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 是 | - | 用户ID，主键，自增 |
| nickname | VARCHAR | 50 | 是 | - | 用户昵称 |
| phone | VARCHAR | 11 | 是 | - | 手机号，唯一索引 |
| password | VARCHAR | 255 | 是 | - | 密码（加密存储） |
| created_at | DATETIME | - | 是 | NOW() | 注册时间 |
| updated_at | DATETIME | - | 是 | NOW() | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_phone (phone)

---

### 5.2 商品表（products）

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 是 | - | 商品ID，主键，自增 |
| name | VARCHAR | 200 | 是 | - | 商品名称 |
| image | VARCHAR | 500 | 是 | - | 商品主图URL |
| price | DECIMAL | 10,2 | 是 | - | 商品价格 |
| description | TEXT | - | 是 | - | 商品描述 |
| category | VARCHAR | 50 | 是 | - | 商品分类 |
| sales | INT | - | 是 | 0 | 销量 |
| created_at | DATETIME | - | 是 | NOW() | 创建时间 |
| updated_at | DATETIME | - | 是 | NOW() | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_category (category)
- INDEX idx_sales (sales)

---

### 5.3 购物车表（cart_items）

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 是 | - | 购物车项ID，主键，自增 |
| user_id | INT | - | 是 | - | 用户ID，外键关联users表 |
| product_id | INT | - | 是 | - | 商品ID，外键关联products表 |
| quantity | INT | - | 是 | 1 | 商品数量 |
| created_at | DATETIME | - | 是 | NOW() | 添加时间 |
| updated_at | DATETIME | - | 是 | NOW() | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_user_product (user_id, product_id)
- INDEX idx_user_id (user_id)

**外键约束**：
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE

---

### 5.4 订单表（orders）

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 是 | - | 订单ID，主键，自增 |
| order_no | VARCHAR | 50 | 是 | - | 订单号，唯一索引 |
| user_id | INT | - | 是 | - | 用户ID，外键关联users表 |
| total_amount | DECIMAL | 10,2 | 是 | - | 订单总金额 |
| status | TINYINT | - | 是 | 0 | 订单状态（0:待支付 1:待发货 2:配送中 3:已完成 4:已取消） |
| pay_status | TINYINT | - | 是 | 0 | 支付状态（0:未支付 1:已支付） |
| pay_method | VARCHAR | 20 | 是 | - | 支付方式（支付宝、微信支付） |
| delivery_time | DATETIME | - | 否 | - | 预计送达时间 |
| actual_delivery_time | DATETIME | - | 否 | - | 实际送达时间 |
| receiver_name | VARCHAR | 50 | 是 | - | 收货人姓名 |
| receiver_phone | VARCHAR | 11 | 是 | - | 收货人手机号 |
| receiver_address | VARCHAR | 500 | 是 | - | 收货地址 |
| created_at | DATETIME | - | 是 | NOW() | 下单时间 |
| updated_at | DATETIME | - | 是 | NOW() | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_order_no (order_no)
- INDEX idx_user_id (user_id)
- INDEX idx_status (status)
- INDEX idx_created_at (created_at)

**外键约束**：
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

---

### 5.5 订单商品表（order_items）

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 是 | - | 订单商品ID，主键，自增 |
| order_id | INT | - | 是 | - | 订单ID，外键关联orders表 |
| product_id | INT | - | 是 | - | 商品ID，外键关联products表 |
| product_name | VARCHAR | 200 | 是 | - | 商品名称（冗余字段，便于查询） |
| product_image | VARCHAR | 500 | 是 | - | 商品图片（冗余字段，便于查询） |
| price | DECIMAL | 10,2 | 是 | - | 商品单价（下单时快照） |
| quantity | INT | - | 是 | 1 | 购买数量 |
| subtotal | DECIMAL | 10,2 | 是 | - | 商品小计 |
| created_at | DATETIME | - | 是 | NOW() | 创建时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_order_id (order_id)
- INDEX idx_product_id (product_id)

**外键约束**：
- FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
- FOREIGN KEY (product_id) REFERENCES products(id)

---

### 5.6 收货地址表（addresses）

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 是 | - | 地址ID，主键，自增 |
| user_id | INT | - | 是 | - | 用户ID，外键关联users表 |
| receiver_name | VARCHAR | 50 | 是 | - | 收货人姓名 |
| receiver_phone | VARCHAR | 11 | 是 | - | 收货人手机号 |
| province | VARCHAR | 50 | 是 | - | 省份 |
| city | VARCHAR | 50 | 是 | - | 城市 |
| district | VARCHAR | 50 | 是 | - | 区县 |
| detail_address | VARCHAR | 500 | 是 | - | 详细地址 |
| is_default | TINYINT | - | 是 | 0 | 是否默认地址（0:否 1:是） |
| created_at | DATETIME | - | 是 | NOW() | 创建时间 |
| updated_at | DATETIME | - | 是 | NOW() | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_user_id (user_id)

**外键约束**：
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

---

## 6. 接口设计

### 6.1 用户接口

#### 6.1.1 用户注册
- **接口路径**：`POST /api/user/register`
- **请求参数**：
  ```json
  {
    "phone": "13800138000",
    "password": "123456",
    "confirmPassword": "123456"
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "注册成功",
    "data": {
      "userId": 1,
      "nickname": "用户138",
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  }
  ```

#### 6.1.2 用户登录
- **接口路径**：`POST /api/user/login`
- **请求参数**：
  ```json
  {
    "phone": "13800138000",
    "password": "123456"
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "userId": 1,
      "nickname": "用户138",
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  }
  ```

#### 6.1.3 修改密码
- **接口路径**：`POST /api/user/changePassword`
- **请求参数**：
  ```json
  {
    "oldPassword": "123456",
    "newPassword": "654321",
    "confirmPassword": "654321"
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "密码修改成功"
  }
  ```

#### 6.1.4 获取个人信息
- **接口路径**：`GET /api/user/info`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "userId": 1,
      "nickname": "用户138",
      "phone": "13800138000",
      "createdAt": "2026-01-29 10:00:00"
    }
  }
  ```

#### 6.1.5 修改个人信息
- **接口路径**：`PUT /api/user/info`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "nickname": "新昵称"
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "修改成功"
  }
  ```

#### 6.1.6 收货地址列表
- **接口路径**：`GET /api/address/list`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "addressId": 1,
        "receiverName": "张三",
        "receiverPhone": "13800138000",
        "province": "广东省",
        "city": "深圳市",
        "district": "南山区",
        "detailAddress": "科技园南区123号",
        "isDefault": 1
      }
    ]
  }
  ```

#### 6.1.7 新增收货地址
- **接口路径**：`POST /api/address/add`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "detailAddress": "科技园南区123号",
    "isDefault": 1
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "添加成功"
  }
  ```

#### 6.1.8 编辑收货地址
- **接口路径**：`PUT /api/address/update/:id`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "detailAddress": "科技园南区123号",
    "isDefault": 1
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "修改成功"
  }
  ```

#### 6.1.9 删除收货地址
- **接口路径**：`DELETE /api/address/delete/:id`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "删除成功"
  }
  ```

#### 6.1.10 设为默认地址
- **接口路径**：`PUT /api/address/default/:id`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "设置成功"
  }
  ```

---

### 6.2 商品接口

#### 6.2.1 商品列表
- **接口路径**：`GET /api/products/list`
- **请求参数**：
  - `page`: 页码（默认1）
  - `pageSize`: 每页数量（默认20）
  - `category`: 分类（可选）
  - `keyword`: 搜索关键词（可选）
  - `sort`: 排序方式（可选，值：price_asc, price_desc, sales）
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "productId": 1,
          "name": "招牌汉堡",
          "image": "https://example.com/image1.jpg",
          "price": 28.00,
          "description": "精选牛肉，新鲜蔬菜",
          "category": "美食",
          "sales": 999
        }
      ],
      "total": 100,
      "page": 1,
      "pageSize": 20
    }
  }
  ```

#### 6.2.2 商品详情
- **接口路径**：`GET /api/products/detail/:id`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "productId": 1,
      "name": "招牌汉堡",
      "image": "https://example.com/image1.jpg",
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg"
      ],
      "price": 28.00,
      "description": "精选牛肉，新鲜蔬菜，秘制酱料",
      "category": "美食",
      "sales": 999
    }
  }
  ```

---

### 6.3 购物车接口

#### 6.3.1 添加到购物车
- **接口路径**：`POST /api/cart/add`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "productId": 1,
    "quantity": 2
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "已加入购物车"
  }
  ```

#### 6.3.2 购物车列表
- **接口路径**：`GET /api/cart/list`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "cartItemId": 1,
        "productId": 1,
        "name": "招牌汉堡",
        "image": "https://example.com/image1.jpg",
        "price": 28.00,
        "quantity": 2,
        "subtotal": 56.00
      }
    ],
    "totalQuantity": 2,
    "totalAmount": 56.00
  }
  ```

#### 6.3.3 修改购物车商品数量
- **接口路径**：`PUT /api/cart/update/:id`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "quantity": 3
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "修改成功"
  }
  ```

#### 6.3.4 删除购物车商品
- **接口路径**：`DELETE /api/cart/delete/:id`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "删除成功"
  }
  ```

---

### 6.4 订单接口

#### 6.4.1 创建订单
- **接口路径**：`POST /api/orders/create`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "addressId": 1,
    "cartItems": [
      {
        "productId": 1,
        "quantity": 2
      }
    ],
    "payMethod": "支付宝"
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "订单创建成功",
    "data": {
      "orderId": 1001,
      "orderNo": "20260129100001",
      "totalAmount": 56.00,
      "payMethod": "支付宝"
    }
  }
  ```

#### 6.4.2 订单列表
- **接口路径**：`GET /api/orders/list`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `page`: 页码（默认1）
  - `pageSize`: 每页数量（默认10）
  - `status`: 订单状态（可选，0:待支付 1:待发货 2:配送中 3:已完成）
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "orderId": 1001,
          "orderNo": "20260129100001",
          "totalAmount": 56.00,
          "status": 0,
          "statusText": "待支付",
          "createdAt": "2026-01-29 14:30:00",
          "deliveryTime": "2026-01-29 18:00:00",
          "products": [
            {
              "name": "招牌汉堡",
              "image": "https://example.com/image1.jpg",
              "quantity": 2,
              "price": 28.00
            }
          ]
        }
      ],
      "total": 10,
      "page": 1,
      "pageSize": 10
    }
  }
  ```

#### 6.4.3 订单详情
- **接口路径**：`GET /api/orders/detail/:id`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "orderId": 1001,
      "orderNo": "20260129100001",
      "totalAmount": 56.00,
      "status": 0,
      "statusText": "待支付",
      "payStatus": 0,
      "payStatusText": "未支付",
      "payMethod": "支付宝",
      "createdAt": "2026-01-29 14:30:00",
      "deliveryTime": "2026-01-29 18:00:00",
      "receiverName": "张三",
      "receiverPhone": "13800138000",
      "receiverAddress": "广东省深圳市南山区科技园南区123号",
      "products": [
        {
          "productName": "招牌汉堡",
          "productImage": "https://example.com/image1.jpg",
          "price": 28.00,
          "quantity": 2,
          "subtotal": 56.00
        }
      ]
    }
  }
  ```

#### 6.4.4 取消订单
- **接口路径**：`POST /api/orders/cancel/:id`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "订单已取消"
  }
  ```

#### 6.4.5 确认收货
- **接口路径**：`POST /api/orders/confirm/:id`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "确认收货成功"
  }
  ```

---

### 6.5 支付接口

#### 6.5.1 发起支付
- **接口路径**：`POST /api/payment/pay`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "orderId": 1001,
    "payMethod": "支付宝"
  }
  ```
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "支付成功",
    "data": {
      "orderId": 1001,
      "orderNo": "20260129100001",
      "payAmount": 56.00,
      "payTime": "2026-01-29 14:31:00"
    }
  }
  ```

#### 6.5.2 查询支付状态
- **接口路径**：`GET /api/payment/status/:orderId`
- **请求头**：`Authorization: Bearer {token}`
- **响应数据**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "orderId": 1001,
      "payStatus": 1,
      "payStatusText": "已支付",
      "payMethod": "支付宝",
      "payTime": "2026-01-29 14:31:00"
    }
  }
  ```

---

### 6.6 通用响应格式

所有接口的响应格式统一如下：

**成功响应**：
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

**失败响应**：
```json
{
  "code": 400,
  "message": "错误信息描述",
  "data": null
}
```

**状态码说明**：
- `200`: 成功
- `400`: 请求参数错误
- `401`: 未授权
- `403`: 无权限
- `404`: 资源不存在
- `500`: 服务器内部错误

---

## 7. 非功能需求

### 7.1 性能要求

#### 7.1.1 响应时间
- **页面加载时间**：首屏加载时间不超过2秒
- **API响应时间**：大部分接口响应时间不超过500ms
- **数据库查询时间**：单次查询不超过100ms

#### 7.1.2 并发能力
- **支持并发用户数**：初期支持100个并发用户
- **峰值处理能力**：可承受短时间内500个并发请求

#### 7.1.3 系统可用性
- **系统可用性**：99.5%（月度）
- **故障恢复时间**：系统故障后30分钟内恢复服务

### 7.2 安全要求

#### 7.2.1 用户安全
- **密码加密**：用户密码使用bcrypt加密存储，不可逆
- **Token安全**：使用JWT（JSON Web Token）进行身份验证，Token有效期7天
- **防SQL注入**：所有数据库查询使用参数化查询，防止SQL注入攻击
- **XSS防护**：前端对用户输入进行转义，防止XSS攻击

#### 7.2.2 数据安全
- **HTTPS传输**：生产环境使用HTTPS协议，确保数据传输安全
- **敏感信息保护**：用户手机号、地址等敏感信息不在日志中输出
- **数据备份**：数据库每日自动备份，备份保留30天

#### 7.2.3 接口安全
- **接口鉴权**：除注册和登录接口外，所有接口都需要Token验证
- **限流保护**：对频繁请求的接口进行限流，防止恶意刷单
- **参数校验**：所有接口参数进行严格校验，防止非法参数注入

### 7.3 可用性要求

#### 7.3.1 易用性
- **页面响应式**：支持主流桌面浏览器（Chrome、Firefox、Safari、Edge）
- **操作简便**：核心功能（如下单）操作步骤不超过5步
- **错误提示**：提供清晰明确的错误提示信息，指导用户正确操作

#### 7.3.2 可维护性
- **代码规范**：遵循ESLint代码规范，保持代码风格统一
- **注释完整**：关键业务逻辑添加注释，便于后续维护
- **日志记录**：记录系统运行日志，便于问题排查

#### 7.3.3 可扩展性
- **前后端分离**：采用前后端分离架构，便于独立扩展
- **模块化设计**：功能模块解耦，便于独立开发和部署
- **数据库设计**：数据库表设计考虑未来扩展性，预留字段

---

## 8. 实施计划

### 8.1 开发阶段划分

#### 第一阶段：项目搭建（1周）
**目标**：完成项目基础架构搭建
- **前端**
  - 初始化Vue.js项目
  - 配置Vue Router路由
  - 配置Pinia状态管理
  - 集成Element Plus UI组件库
  - 配置Axios请求拦截器

- **后端**
  - 初始化Node.js项目
  - 配置Express.js框架
  - 配置MySQL数据库连接
  - 配置跨域处理（CORS）
  - 配置日志记录
  - 配置JWT身份验证中间件

- **数据库**
  - 创建数据库
  - 创建所有数据表
  - 插入测试数据（商品数据）

#### 第二阶段：用户模块（1周）
**目标**：完成用户注册登录及个人信息管理功能
- **前端**
  - 注册页面
  - 登录页面
  - 个人中心页面
  - 修改密码弹窗
  - 收货地址管理页面

- **后端**
  - 用户注册接口
  - 用户登录接口
  - 修改密码接口
  - 获取个人信息接口
  - 修改个人信息接口
  - 收货地址列表接口
  - 新增收货地址接口
  - 编辑收货地址接口
  - 删除收货地址接口
  - 设为默认地址接口

#### 第三阶段：商品模块（1周）
**目标**：完成商品浏览、搜索、分类筛选功能
- **前端**
  - 首页（商品列表）
  - 商品详情页面
  - 商品搜索组件
  - 分类筛选组件
  - 排序组件

- **后端**
  - 商品列表接口
  - 商品详情接口
  - 商品搜索接口

#### 第四阶段：购物车模块（1周）
**目标**：完成购物车管理功能
- **前端**
  - 购物车页面
  - 商品列表页加入购物车按钮
  - 商品详情页加入购物车按钮
  - 购物车商品数量加减组件

- **后端**
  - 添加到购物车接口
  - 购物车列表接口
  - 修改购物车商品数量接口
  - 删除购物车商品接口

#### 第五阶段：订单模块（1.5周）
**目标**：完成订单管理功能
- **前端**
  - 订单确认页面
  - 订单列表页面
  - 订单详情页面
  - 取消订单确认弹窗
  - 确认收货确认弹窗

- **后端**
  - 创建订单接口
  - 订单列表接口
  - 订单详情接口
  - 取消订单接口
  - 确认收货接口
  - 订单状态定时任务（模拟商家发货）

#### 第六阶段：支付模块（0.5周）
**目标**：完成模拟支付功能
- **前端**
  - 支付页面
  - 支付成功页面
  - 支付失败页面

- **后端**
  - 发起支付接口（模拟支付）
  - 查询支付状态接口

#### 第七阶段：测试与优化（1周）
**目标**：完成功能测试和性能优化
- **功能测试**
  - 用户模块测试
  - 商品模块测试
  - 购物车模块测试
  - 订单模块测试
  - 支付模块测试

- **性能优化**
  - 前端加载优化
  - 接口响应优化
  - 数据库查询优化

- **Bug修复**
  - 修复测试中发现的问题
  - 优化用户体验细节

#### 第八阶段：部署上线（0.5周）
**目标**：完成系统部署和上线
- **部署准备**
  - 生产环境配置
  - 域名和SSL证书配置
  - 服务器部署（Nginx + Node.js + MySQL）
  - 数据库初始化

- **上线验证**
  - 冒烟测试（核心功能验证）
  - 性能监控部署
  - 日志监控部署

---

### 8.2 时间规划

| 阶段 | 任务 | 预计周期 | 开始时间 | 结束时间 |
|------|------|----------|----------|----------|
| 第一阶段 | 项目搭建 | 1周 | 第1周 | 第1周 |
| 第二阶段 | 用户模块 | 1周 | 第2周 | 第2周 |
| 第三阶段 | 商品模块 | 1周 | 第3周 | 第3周 |
| 第四阶段 | 购物车模块 | 1周 | 第4周 | 第4周 |
| 第五阶段 | 订单模块 | 1.5周 | 第5周 | 第6周（上） |
| 第六阶段 | 支付模块 | 0.5周 | 第6周（下） | 第6周（下） |
| 第七阶段 | 测试与优化 | 1周 | 第7周 | 第7周 |
| 第八阶段 | 部署上线 | 0.5周 | 第8周（上） | 第8周（上） |
| **总计** | **项目开发** | **8周** | - | - |

**备注**：
- 上述时间规划为预计时间，实际开发周期可能因需求变更、技术难点等因素有所调整
- 建议在开发过程中每周进行进度回顾，及时调整计划
- 测试阶段应预留充足时间，确保系统质量
