<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-step {
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #ddd;
            background: #f9f9f9;
        }
        .success {
            border-left-color: #52c41a;
            background: #f6ffed;
        }
        .error {
            border-left-color: #ff4d4f;
            background: #fff1f0;
        }
        .warning {
            border-left-color: #faad14;
            background: #fffbe6;
        }
        .info {
            border-left-color: #1890ff;
            background: #e6f7ff;
        }
        .cart-info {
            background: #fff;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #40a9ff;
        }
        button:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }
        .log {
            background: #262626;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•æ§åˆ¶</h2>
        <button onclick="runAllTests()" id="runAllBtn">â–¶ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="resetCart()">â†º æ¸…ç©ºè´­ç‰©è½¦</button>
        <button onclick="clearLog()">ğŸ—‘ æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="test-section">
        <h2>å½“å‰è´­ç‰©è½¦çŠ¶æ€</h2>
        <div class="cart-info" id="cartInfo">
            <p>è´­ç‰©è½¦æ•°æ®åŠ è½½ä¸­...</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•æ­¥éª¤</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•æ—¥å¿—</h2>
        <div class="log" id="testLog">å‡†å¤‡å°±ç»ª...</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : type === 'warning' ? 'âš ' : 'â„¹';
            logDiv.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = 'æ—¥å¿—å·²æ¸…ç©º...\n';
        }
        
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-step ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }
        
        function clearTestResults() {
            document.getElementById('testResults').innerHTML = '';
        }
        
        function getCartData() {
            const cartData = localStorage.getItem('cart');
            return cartData ? JSON.parse(cartData) : { items: [] };
        }
        
        function updateCartInfo() {
            const cart = getCartData();
            const cartInfo = document.getElementById('cartInfo');
            
            if (cart.items.length === 0) {
                cartInfo.innerHTML = '<p>ğŸ“­ è´­ç‰©è½¦ä¸ºç©º</p>';
            } else {
                let html = `<p><strong>ğŸ“¦ å•†å“æ•°é‡:</strong> ${cart.items.length}</p>`;
                html += '<ul>';
                cart.items.forEach((item, index) => {
                    html += `<li>
                        <strong>${item.name}</strong><br>
                        ä»·æ ¼: ${item.price}<br>
                        æ•°é‡: ${item.quantity}
                    </li>`;
                });
                html += '</ul>';
                cartInfo.innerHTML = html;
            }
        }
        
        function resetCart() {
            localStorage.removeItem('cart');
            localStorage.removeItem('cartId');
            log('è´­ç‰©è½¦å·²æ¸…ç©º', 'success');
            updateCartInfo();
        }
        
        async function runAllTests() {
            const runAllBtn = document.getElementById('runAllBtn');
            runAllBtn.disabled = true;
            runAllBtn.textContent = 'â³ æµ‹è¯•ä¸­...';
            
            clearTestResults();
            clearLog();
            log('å¼€å§‹è¿è¡Œæµ‹è¯•...', 'info');
            
            let testPassed = 0;
            let testFailed = 0;
            
            try {
                // æµ‹è¯•1: æ£€æŸ¥localStorageæ˜¯å¦å¯ç”¨
                log('\n=== æµ‹è¯•1: localStorageå¯ç”¨æ€§ ===', 'info');
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    addTestResult('âœ“ localStorageåŠŸèƒ½æ­£å¸¸', 'success');
                    log('localStorageåŠŸèƒ½æ­£å¸¸', 'success');
                    testPassed++;
                } catch (e) {
                    addTestResult('âœ— localStorageä¸å¯ç”¨', 'error');
                    log('localStorageä¸å¯ç”¨: ' + e.message, 'error');
                    testFailed++;
                }
                
                // æµ‹è¯•2: æ¸…ç©ºè´­ç‰©è½¦
                log('\n=== æµ‹è¯•2: æ¸…ç©ºè´­ç‰©è½¦ ===', 'info');
                resetCart();
                addTestResult('âœ“ è´­ç‰©è½¦å·²æ¸…ç©º', 'success');
                testPassed++;
                
                // æµ‹è¯•3: æ‰“å¼€æ–°çª—å£è®¿é—®äº§å“é¡µé¢
                log('\n=== æµ‹è¯•3: æ‰“å¼€äº§å“é¡µé¢ ===', 'info');
                addTestResult('â„¹ è¯·åœ¨æ–°æ‰“å¼€çš„çª—å£ä¸­ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®', 'info');
                addTestResult('â„¹ ç„¶åå…³é—­æ–°çª—å£è¿”å›è¿™é‡Œç»§ç»­æµ‹è¯•', 'info');
                log('æ­£åœ¨æ‰“å¼€äº§å“é¡µé¢...', 'info');
                
                const productsWindow = window.open('http://localhost:3000/products', '_blank', 'width=800,height=600');
                
                if (productsWindow) {
                    addTestResult('âœ“ äº§å“é¡µé¢å·²æ‰“å¼€', 'success');
                    log('äº§å“é¡µé¢å·²æ‰“å¼€', 'success');
                    testPassed++;
                    
                    // ç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨æ“ä½œ
                    addTestResult('â³ ç­‰å¾…ç”¨æˆ·æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦...', 'warning');
                    log('è¯·åœ¨äº§å“é¡µé¢ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®...', 'warning');
                    
                    // æ¯2ç§’æ£€æŸ¥è´­ç‰©è½¦çŠ¶æ€
                    let checkCount = 0;
                    const checkInterval = setInterval(() => {
                        checkCount++;
                        updateCartInfo();
                        const cart = getCartData();
                        
                        if (cart.items.length > 0) {
                            clearInterval(checkInterval);
                            log('æ£€æµ‹åˆ°è´­ç‰©è½¦æœ‰å•†å“ï¼', 'success');
                            
                            // æµ‹è¯•4: éªŒè¯è´­ç‰©è½¦æ•°æ®
                            log('\n=== æµ‹è¯•4: éªŒè¯è´­ç‰©è½¦æ•°æ® ===', 'info');
                            addTestResult(`âœ“ è´­ç‰©è½¦ä¸­æœ‰ ${cart.items.length} ä¸ªå•†å“`, 'success');
                            log(`è´­ç‰©è½¦ä¸­æœ‰ ${cart.items.length} ä¸ªå•†å“`, 'success');
                            
                            const firstItem = cart.items[0];
                            addTestResult(`âœ“ ç¬¬ä¸€ä¸ªå•†å“: ${firstItem.name}, ä»·æ ¼: ${firstItem.price}, æ•°é‡: ${firstItem.quantity}`, 'success');
                            log(`å•†å“è¯¦æƒ…: ${firstItem.name} - ${firstItem.price} x ${firstItem.quantity}`, 'success');
                            testPassed++;
                            
                            // æµ‹è¯•5: æµ‹è¯•localStorageæŒä¹…åŒ–
                            log('\n=== æµ‹è¯•5: localStorageæŒä¹…åŒ– ===', 'info');
                            addTestResult('â„¹ è¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹è´­ç‰©è½¦æ•°æ®æ˜¯å¦ä¿æŒ...', 'info');
                            log('è´­ç‰©è½¦æ•°æ®å·²ä¿å­˜åˆ°localStorage', 'success');
                            addTestResult('âœ“ è´­ç‰©è½¦æ•°æ®å·²ä¿å­˜', 'success');
                            testPassed++;
                            
                            // æµ‹è¯•æ€»ç»“
                            setTimeout(() => {
                                log('\n=== æµ‹è¯•æ€»ç»“ ===', 'info');
                                log(`æµ‹è¯•é€šè¿‡: ${testPassed}`, 'success');
                                log(`æµ‹è¯•å¤±è´¥: ${testFailed}`, testFailed > 0 ? 'error' : 'info');
                                log(`æ€»è®¡: ${testPassed + testFailed} ä¸ªæµ‹è¯•`, 'info');
                                
                                addTestResult(`\n=== æµ‹è¯•å®Œæˆ ===`, 'info');
                                addTestResult(`âœ“ é€šè¿‡: ${testPassed}`, 'success');
                                if (testFailed > 0) {
                                    addTestResult(`âœ— å¤±è´¥: ${testFailed}`, 'error');
                                }
                                
                                runAllBtn.disabled = false;
                                runAllBtn.textContent = 'â–¶ è¿è¡Œæ‰€æœ‰æµ‹è¯•';
                            }, 1000);
                        } else if (checkCount >= 30) { // 60ç§’è¶…æ—¶
                            clearInterval(checkInterval);
                            addTestResult('âœ— è¶…æ—¶ï¼šæœªæ£€æµ‹åˆ°è´­ç‰©è½¦æ›´æ–°', 'error');
                            log('è¶…æ—¶ï¼šæœªæ£€æµ‹åˆ°è´­ç‰©è½¦æ›´æ–°', 'error');
                            testFailed++;
                            
                            runAllBtn.disabled = false;
                            runAllBtn.textContent = 'â–¶ è¿è¡Œæ‰€æœ‰æµ‹è¯•';
                        }
                    }, 2000);
                    
                } else {
                    addTestResult('âœ— æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®', 'error');
                    log('æ— æ³•æ‰“å¼€æ–°çª—å£', 'error');
                    testFailed++;
                    runAllBtn.disabled = false;
                    runAllBtn.textContent = 'â–¶ è¿è¡Œæ‰€æœ‰æµ‹è¯•';
                }
                
            } catch (error) {
                addTestResult(`âœ— æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
                log('æµ‹è¯•å‡ºé”™: ' + error.message, 'error');
                testFailed++;
                runAllBtn.disabled = false;
                runAllBtn.textContent = 'â–¶ è¿è¡Œæ‰€æœ‰æµ‹è¯•';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ›´æ–°è´­ç‰©è½¦ä¿¡æ¯
        updateCartInfo();
        log('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹æµ‹è¯•', 'info');
    </script>
</body>
</html>
